name: Build ITPipes Connect
on:
  push:
    branches: [ "main" ]

jobs:
  echo-github-context:
    name: Echo GitHub Context
    environment: ITPipesMobile
    runs-on: windows-latest
    steps:
    ############################################################################################################################
    # Echo Echo GitHub Context
    ############################################################################################################################
    - name: Echo GitHub Context
      id: echo-github-context
      # run: echo "$GITHUB_CONTEXT"
      # run: echo ${{ env.GITHUB_CONTEXT }}
      run: echo "$env:GITHUB_CONTEXT"
      env:
        GITHUB_CONTEXT: ${{ toJson(github) }}

  check-pr-labels:
    name: Check PR Labels
    environment: ITPipesMobile
    runs-on: windows-latest
    outputs:
        passed: ${{ steps.check-pr-labels.outputs.hasLabel }}
    steps:

    ############################################################################################################################
    # Check PR Labels
    ############################################################################################################################
    - name: Get PR Labels
      id: check-pr-labels
      uses: actions/github-script@v5
      with:
        script: |
          const prNumber = context.payload.pull_request.number;
          const { data: { labels } } = await github.rest.pulls.get({
            owner: context.repo.owner,
            repo: context.repo.repo,
            pull_number: prNumber
          });
          const hasLabel = labels.some(label => label.name === 'BuildITpipesConnect');
          return { hasLabel };

    ############################################################################################################################
    # Echo Check PR Labels Result
    ############################################################################################################################
    - name: Echo Check Labels PR Result
      id: echo-check-pr-labels-results
      run: echo "${{ steps.check-pr-labels.outputs.result }}"

    - name: Echo Check Labels PR Result
      id: echo-check-pr-labels-results
      run: echo "Has BuildITpipesConnect label: ${{ steps.check-pr-labels.outputs.hasLabel }}"